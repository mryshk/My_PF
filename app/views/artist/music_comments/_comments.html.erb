<!--コメント一覧と新規フォーム-->
<div class="col-8 mt-5 offset-2">
  <h3><i class="fas fa-comments "></i> Comment</h3>
  <div class="table-responsive">
  <!--コメント一覧-->
  <table class="table table-hover mt-3" >
    <tbody>
      <% music_comments.each do |music_comment| %>
      <tr>
        <!--コメントリスナー-->
        <td class=" align-middle text-center" style="width:20%;">
          <!--リスナー詳細へ-->
          <%= link_to  listener_path(music_comment.listener_id), class: "text-dark" do %>
          <div><%= attachment_image_tag music_comment.listener,:profile_image ,size:"50x50", fallback: "no_image.jpg",class:"mt-3 rounded-circle" %></div>
          <div>&ensp;<%= music_comment.listener.name %></div>
          <% end %>
        </td>
        <!--コメント-->
        <td class="align-middle " style="width:40%;" ><%= music_comment.comment %></td>
        <!--星ランク表示-->
        <td class="align-middle " style="width:20%;" >
          <% unless music_comment.rate.nil? %>
          <div id="music_post_rate_<%= music_comment.id  %>" data-score="<%= music_comment.rate %>" class="text-center mt-3"></div>
          <!--ランク表示Javascript-->
          <script>
              $('#music_post_rate_<%= music_comment.id %>').empty();
              $('#music_post_rate_<%= music_comment.id  %>').raty({
                readOnly: true,
                starOn: "<%= asset_path('star-on.png') %>",
                starOff: "<%= asset_path('star-off.png') %>",
                starHalf: "<%= asset_path('star-half.png') %>",
                score: function() {
                return $(this).attr('data-score');
              }
             });
          </script>
          <% end %>
        <!--コメント編集・削除-->
        <!--ログインユーザーと一致すれば-->
        <% if music_comment.listener == current_listener %>
        <td class="align-middle text-center" style="width:20%;">
          <div class="btn d-block" style="width: 70px; ">
            <%= link_to edit_artist_album_album_music_music_comment_path(music_comment.album,music_comment.album_music,music_comment),method: :get, class: "text-info" do %>
              <i class="fas fa-edit">Edit</i>
            <% end %>
          </div>
          <div class="btn d-block" style="width: 70px; ">
            <%= link_to artist_album_album_music_music_comment_path(music_comment.album,music_comment.album_music,music_comment),method: :delete,'data-confirm' => "Do you really want to delete?", class: "text-danger",remote: true do %>
              <i class="fas fa-trash-alt">Delete</i>
            <% end %>
          </div>
          </td>
        <% end %>
      </tr>
      <% end %>
    </tbody>
  </table>
  </div>
  <!--コメント投稿フォーム-->
  <div >
    <%= form_with(model:[ album, album_music, music_comment],url: artist_album_album_music_music_comments_path(album,album_music) ,local: false) do |f| %>
    <!--コメント欄-->
    <div>
      <%= f.text_area :comment, rows:'5',placeholder: "Comment" ,class: "form-control" %>
    </div>
    <!--ランク入力-->
    <div id="post_star" class="mb-2 mt-3">
      <%= f.label :post_rate,'Rating' %>
      <%= f.hidden_field :rate,id: :review_star %>
    </div>
    <!--ランク入力用Javascript-->
    <script>
        $('#post_star').raty({
       starOn: "<%= asset_path('star-on.png') %>",
       starOff: "<%= asset_path('star-off.png') %>",
       starHalf: "<%= asset_path('star-half.png') %>",
       scoreName: 'music_comment[rate]', //登録するモデル名とカラム名を記述
       half: true,
       });
    </script>
    <!--送信ボタン-->
    <button class="btn btn-main mt-4" style="width:100px">Post
      <%= f.hidden_field :listener_id, :value => current_listener.id %>
      <% f.submit %>
    </button>
    <% end %>
  </div>
</div>

