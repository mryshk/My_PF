<div class="row no-gutters mt-5" >
  <div class="col ml-5">

  </div>
  <div class="col-lg-5 offset-lg-1" >
    <% @posts.each do |post| %>
    <div class="card">
      <div class="card-body">
        <%# 名前と画像 %>
        <div class="card-text" >
        <%= link_to listener_path(post.listener),class: "text-dark" do %>
          <div class="d-block">
            <%= attachment_image_tag post.listener,:profile_image ,size:"60x60", fallback: "no_image.jpg",class: "mt-3 rounded-circle" %>
          </div>
          <div class="d-block align-middle" style="font-size: 13px;">
            <%= post.listener.name%>
            <% if post.listener.listener_type == 1  %>
              <i class="fa fa-circle" style="color: gold;"></i>
            <% end %>
          </div>
        <% end %>
        </div>
        <%# 投稿文 %>
        <h5 class="card-text text-center mt-2"><%= post.post_tweet  %></h5>
        <!--タグ一覧-->
        <p class="card-text text-center">
          <% post.tags.each do |tag| %>
            <%= link_to tag.tag_name, search_tag_posts_path(tag_id: tag.id) , class: "tag" %>
          <% end %>
        </p>
        <div class="text-center mt-5">
          <%= link_to post_path(post) do %>
            <%= attachment_image_tag post,:picture,:fill,200,200%>
          <% end %>
        </div>
        <p class="card-text text-center"></p>
        <div class="mt-4 text-center" >
          <%# 詳細画面へ %>
          <div class="d-inline mt-4" style="margin-right:80px;" >
            <%= link_to post_path(post) do %><i class="fas fa-arrow-circle-right fa-lg text-dark"><p class="text-dark" style="font-size:12px;">Detail</p></i><% end %>
          </div>
          <%# 曲視聴 %>
          <div class="d-inline mt-4" style="margin-right:80px;" >
            <a class="card-title text-center" href="<%= post.post_url %>" target="_blank"><i class="fas fa-headphones-alt fa-lg"><p class="text-dark" style="font-size:12px;">Music</p></i></a>
          </div>
          <%# ファボ %>
          <div class="d-inline mt-4" style="margin-right:80px;"  id="post_post_favorite_<%= post.id  %>">
            <% @favorite = PostFavorite.find_by(post_id: post.id,listener_id: current_listener.id) %>
            <%= render 'public/post_favorites/favorite', post: post, favorite: @favorite %>
          </div>
          <%# コメント数 %>
          <div class="d-inline ml-2 mt-4">
            <i class="fas fa-comments text-info fa-lg"><%= post.post_comments.count %></br><p class="text-dark" style="font-size:12px;">Comments</p></i>
          </div>
          <%# 投稿日 %>
          <div class="text-right"><%= time_ago_in_words(post.created_at) %></div>
        </div>
      </div>
    </div>
    <% end %>
  </div>
  <div class="col offset-lg-1 mr-5">
    <table class="table mb-5">
      <thead class="">
        <span class="circle">
          <h6 class="text-center">いいねランキング</h6>
        </span>
      </thead>
      <% i = 0  %>
      <% @post_favorite_rank.each do |fav_rank|  %>
      <tr>
        <th class="align-middle" style="padding:0;">
          <% i += 1  %>
          <%= i %>
        </th>
        <td class="d-flex">
          <div>
            <div>
              <%= attachment_image_tag fav_rank.listener, :profile_image, :fill, 30, 30, fallback: "no_image.jpg",size: "30x30",class: " rounded-circle" %>
            </div>
            <div style="font-size: 10px;">
              <%= fav_rank.listener.name %>
            </div>
          </div>
          <p class="align-self-center ml-3"style="font-size: 12px;" ><%= fav_rank.post_tweet.truncate(15) %></p>
        </td>
        <td class="align-middle">
          <p class="d-block text-center" style=" font-size: 12px; margin:0;" ><%= fav_rank.post_favorites.count %></p>
          <p class="d-block" style="font-size: 10px;">Likes</p>
        </td>
      </tr>
      <% break if i== 5 %>
      <% end %>
    </table>
    <table class="table">
      <thead>
        <h6 class="text-center">閲覧数ランキング</h6>
      </thead>
      <% i = 0  %>
      <% @post_impression_rank.each do |imp_rank|  %>
      <tr>
        <th class="align-middle">
          <% i += 1  %>
          <%= i %>
        </th>
        <td class="d-flex">
          <div>
            <div>
              <%= attachment_image_tag imp_rank.listener, :profile_image, :fill, 30, 30, fallback: "no_image.jpg",size: "30x30",class: " rounded-circle" %>
            </div>
            <div style="font-size: 10px;">
              <%= imp_rank.listener.name %>
            </div>
          </div>
          <p class="align-self-center ml-3" style="font-size: 12px;"><%= imp_rank.post_tweet.truncate(15) %> </p>
        </td>
        <td class="align-middle" >
          <p ><%= imp_rank.impressions_count %></p>
        </td>
      </tr>
      <% break if i== 5 %>
      <% end %>
    </table>
  </div>
</div>

